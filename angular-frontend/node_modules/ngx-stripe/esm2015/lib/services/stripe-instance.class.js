import { BehaviorSubject, from } from 'rxjs';
import { filter, first, map, switchMap } from 'rxjs/operators';
export class StripeInstance {
    constructor(loader, window, key, options) {
        this.loader = loader;
        this.window = window;
        this.key = key;
        this.options = options;
        this.stripe$ = new BehaviorSubject(undefined);
        this.stripe = this.stripe$
            .asObservable()
            .pipe(filter((stripe) => Boolean(stripe)));
        this.loader
            .asStream()
            .pipe(filter((status) => status.loaded === true), first(), map(() => this.window.getNativeWindow().Stripe))
            .subscribe((stripeInstance) => {
            const stripe = this.options
                ? stripeInstance(this.key, this.options)
                : stripeInstance(this.key);
            this.stripe$.next(stripe);
        });
    }
    getInstance() {
        return this.stripe$.getValue();
    }
    elements(options) {
        return this.stripe$.asObservable().pipe(filter((stripe) => Boolean(stripe)), map((stripe) => stripe.elements(options)), first());
    }
    redirectToCheckout(options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.redirectToCheckout(options))), first());
    }
    confirmAuBecsDebitPayment(clientSecret, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmAuBecsDebitPayment(clientSecret, data))), first());
    }
    confirmBancontactPayment(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmBancontactPayment(clientSecret, data, options))), first());
    }
    confirmCardPayment(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmCardPayment(clientSecret, data, options))), first());
    }
    confirmEpsPayment(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmEpsPayment(clientSecret, data, options))), first());
    }
    confirmFpxPayment(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmFpxPayment(clientSecret, data, options))), first());
    }
    confirmGiropayPayment(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmGiropayPayment(clientSecret, data, options))), first());
    }
    confirmIdealPayment(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmIdealPayment(clientSecret, data, options))), first());
    }
    confirmP24Payment(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmP24Payment(clientSecret, data, options))), first());
    }
    confirmSepaDebitPayment(clientSecret, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmSepaDebitPayment(clientSecret, data))), first());
    }
    handleCardAction(clientSecret) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.handleCardAction(clientSecret))), first());
    }
    createPaymentMethod(paymentMethodData) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.createPaymentMethod(paymentMethodData))), first());
    }
    retrievePaymentIntent(clientSecret) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.retrievePaymentIntent(clientSecret))), first());
    }
    confirmAuBecsDebitSetup(clientSecret, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmAuBecsDebitSetup(clientSecret, data))), first());
    }
    confirmCardSetup(clientSecret, data, options) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmCardSetup(clientSecret, data, options))), first());
    }
    confirmSepaDebitSetup(clientSecret, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmSepaDebitSetup(clientSecret, data))), first());
    }
    retrieveSetupIntent(clientSecret) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmSepaDebitSetup(clientSecret))), first());
    }
    paymentRequest(options) {
        const stripe = this.getInstance();
        return stripe ? stripe.paymentRequest(options) : undefined;
    }
    createToken(tokenType, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.createToken(tokenType, data))), first());
    }
    createSource(a, b) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.createSource(a, b))), first());
    }
    retrieveSource(source) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.retrieveSource(source))), first());
    }
    /**
     * @deprecated
     */
    handleCardPayment(clientSecret, element, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.handleCardPayment(clientSecret, element, data))), first());
    }
    /**
     * @deprecated
     */
    confirmPaymentIntent(clientSecret, element, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmPaymentIntent(clientSecret, element, data))), first());
    }
    /**
     * @deprecated
     */
    handleCardSetup(clientSecret, element, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.handleCardSetup(clientSecret, element, data))), first());
    }
    /**
     * @deprecated
     */
    confirmSetupIntent(clientSecret, element, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.confirmSetupIntent(clientSecret, element, data))), first());
    }
    /**
     * @deprecated
     */
    handleFpxPayment(clientSecret, element, data) {
        return this.stripe.pipe(switchMap((stripe) => from(stripe.handleFpxPayment(clientSecret, element, data))), first());
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaXBlLWluc3RhbmNlLmNsYXNzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXN0cmlwZS9zcmMvbGliL3NlcnZpY2VzL3N0cmlwZS1pbnN0YW5jZS5jbGFzcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN6RCxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUEyRC9ELE1BQU0sT0FBTyxjQUFjO0lBTXpCLFlBQ1UsTUFBMkIsRUFDM0IsTUFBaUIsRUFDakIsR0FBVyxFQUNYLE9BQWtDO1FBSGxDLFdBQU0sR0FBTixNQUFNLENBQXFCO1FBQzNCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFDakIsUUFBRyxHQUFILEdBQUcsQ0FBUTtRQUNYLFlBQU8sR0FBUCxPQUFPLENBQTJCO1FBVHBDLFlBQU8sR0FBRyxJQUFJLGVBQWUsQ0FBcUIsU0FBUyxDQUFDLENBQUM7UUFDckUsV0FBTSxHQUFHLElBQUksQ0FBQyxPQUFPO2FBQ2xCLFlBQVksRUFBRTthQUNkLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFRM0MsSUFBSSxDQUFDLE1BQU07YUFDUixRQUFRLEVBQUU7YUFDVixJQUFJLENBQ0gsTUFBTSxDQUFDLENBQUMsTUFBaUMsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsRUFDckUsS0FBSyxFQUFFLEVBQ1AsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFVLENBQUMsTUFBTSxDQUFDLENBQ3pEO2FBQ0EsU0FBUyxDQUFDLENBQUMsY0FBbUIsRUFB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QUFFLElBQUksQ0FBQyxDQUFDLENBQ3hFLEVBQ0QsS0FBSyxFQUFFLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILGVBQWUsQ0FDYixZQUFvQixFQUNwQixPQUFRLEVBQ1IsSUFBSztRQUtMLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ3JCLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQ25CLElBQUksQ0FBRSxNQUFjLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FDbkUsRUFDRCxLQUFLLEVBQUUsQ0FDUixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsa0JBQWtCLENBQ2hCLFlBQW9CLEVBQ3BCLE9BQVEsRUFDUixJQUFLO1FBS0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDckIsU0FBUyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FDbkIsSUFBSSxDQUFFLE1BQWMsQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQ3RFLEVBQ0QsS0FBSyxFQUFFLENBQ1IsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILGdCQUFnQixDQUNkLFlBQW9CLEVBQ3BCLE9BQVEsRUFDUixJQUFLO1FBS0wsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDckIsU0FBUyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FDbkIsSUFBSSxDQUFFLE1BQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQ3BFLEVBQ0QsS0FBSyxFQUFFLENBQ1IsQ0FBQztJQUNKLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgZnJvbSwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyLCBmaXJzdCwgbWFwLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7XG4gIENvbmZpcm1BdUJlY3NEZWJpdFBheW1lbnREYXRhLFxuICBDb25maXJtQXVCZWNzRGViaXRTZXR1cERhdGEsXG4gIENvbmZpcm1CYW5jb250YWN0UGF5bWVudERhdGEsXG4gIENvbmZpcm1CYW5jb250YWN0UGF5bWVudE9wdGlvbnMsXG4gIENvbmZpcm1DYXJkUGF5bWVudERhdGEsXG4gIENvbmZpcm1DYXJkUGF5bWVudE9wdGlvbnMsXG4gIENvbmZpcm1FcHNQYXltZW50RGF0YSxcbiAgQ29uZmlybUVwc1BheW1lbnRPcHRpb25zLFxuICBDb25maXJtRnB4UGF5bWVudERhdGEsXG4gIENvbmZpcm1GcHhQYXltZW50T3B0aW9ucyxcbiAgQ29uZmlybUdpcm9wYXlQYXltZW50RGF0YSxcbiAgQ29uZmlybUdpcm9wYXlQYXltZW50T3B0aW9ucyxcbiAgQ29uZmlybUlkZWFsUGF5bWVudERhdGEsXG4gIENvbmZpcm1JZGVhbFBheW1lbnRPcHRpb25zLFxuICBDb25maXJtUDI0UGF5bWVudERhdGEsXG4gIENvbmZpcm1QMjRQYXltZW50T3B0aW9ucyxcbiAgQ29uZmlybUNhcmRTZXR1cERhdGEsXG4gIENvbmZpcm1DYXJkU2V0dXBPcHRpb25zLFxuICBDb25maXJtU2VwYURlYml0UGF5bWVudERhdGEsXG4gIENvbmZpcm1TZXBhRGViaXRTZXR1cERhdGEsXG4gIENyZWF0ZVBheW1lbnRNZXRob2REYXRhLFxuICBDcmVhdGVTb3VyY2VEYXRhLFxuICBDcmVhdGVUb2tlbkliYW5EYXRhLFxuICBDcmVhdGVUb2tlbkNhcmREYXRhLFxuICBDcmVhdGVUb2tlblBpaURhdGEsXG4gIENyZWF0ZVRva2VuQmFua0FjY291bnREYXRhLFxuICBQYXltZW50SW50ZW50LFxuICBQYXltZW50TWV0aG9kLFxuICBQYXltZW50UmVxdWVzdCxcbiAgUGF5bWVudFJlcXVlc3RPcHRpb25zLFxuICBSZWRpcmVjdFRvQ2hlY2tvdXRPcHRpb25zLFxuICBSZXRyaWV2ZVNvdXJjZVBhcmFtLFxuICBTZXR1cEludGVudCxcbiAgU3RyaXBlLFxuICBTdHJpcGVDYXJkRWxlbWVudCxcbiAgU3RyaXBlQ2FyZE51bWJlckVsZW1lbnQsXG4gIFN0cmlwZUNhcmRDdmNFbGVtZW50LFxuICBTdHJpcGVDb25zdHJ1Y3Rvck9wdGlvbnMsXG4gIFN0cmlwZUVsZW1lbnRzLFxuICBTdHJpcGVFbGVtZW50c09wdGlvbnMsXG4gIFN0cmlwZUVsZW1lbnQsXG4gIFN0cmlwZUVycm9yLFxuICBTdHJpcGVJYmFuRWxlbWVudCxcbiAgU291cmNlLFxuICBUb2tlbixcbiAgVG9rZW5DcmVhdGVQYXJhbXNcbn0gZnJvbSAnQHN0cmlwZS9zdHJpcGUtanMnO1xuXG5pbXBvcnQgeyBTdHJpcGVTZXJ2aWNlSW50ZXJmYWNlIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9zdHJpcGUtaW5zdGFuY2UuaW50ZXJmYWNlJztcblxuaW1wb3J0IHsgV2luZG93UmVmIH0gZnJvbSAnLi93aW5kb3ctcmVmLnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgTGF6eVN0cmlwZUFQSUxvYWRlcixcbiAgTGF6eVN0cmlwZUFQSUxvYWRlclN0YXR1c1xufSBmcm9tICcuL2FwaS1sb2FkZXIuc2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBTdHJpcGVJbnN0YW5jZSBpbXBsZW1lbnRzIFN0cmlwZVNlcnZpY2VJbnRlcmZhY2Uge1xuICBwcml2YXRlIHN0cmlwZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFN0cmlwZSB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcbiAgc3RyaXBlID0gdGhpcy5zdHJpcGUkXG4gICAgLmFzT2JzZXJ2YWJsZSgpXG4gICAgLnBpcGUoZmlsdGVyKChzdHJpcGUpID0+IEJvb2xlYW4oc3RyaXBlKSkpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbG9hZGVyOiBMYXp5U3RyaXBlQVBJTG9hZGVyLFxuICAgIHByaXZhdGUgd2luZG93OiBXaW5kb3dSZWYsXG4gICAgcHJpdmF0ZSBrZXk6IHN0cmluZyxcbiAgICBwcml2YXRlIG9wdGlvbnM/OiBTdHJpcGVDb25zdHJ1Y3Rvck9wdGlvbnNcbiAgKSB7XG4gICAgdGhpcy5sb2FkZXJcbiAgICAgIC5hc1N0cmVhbSgpXG4gICAgICAucGlwZShcbiAgICAgICAgZmlsdGVyKChzdGF0dXM6IExhenlTdHJpcGVBUElMb2FkZXJTdGF0dXMpID0+IHN0YXR1cy5sb2FkZWQgPT09IHRydWUpLFxuICAgICAgICBmaXJzdCgpLFxuICAgICAgICBtYXAoKCkgPT4gKHRoaXMud2luZG93LmdldE5hdGl2ZVdpbmRvdygpIGFzIGFueSkuU3RyaXBlKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoc3RyaXBlSW5zdGFuY2U6IGFueSkgPT4ge1xuICAgICAgICBjb25zdCBzdHJpcGUgPSB0aGlzLm9wdGlvbnNcbiAgICAgICAgICA/IChzdHJpcGVJbnN0YW5jZSh0aGlzLmtleSwgdGhpcy5vcHRpb25zKSBhcyBTdHJpcGUpXG4gICAgICAgICAgOiAoc3RyaXBlSW5zdGFuY2UodGhpcy5rZXkpIGFzIFN0cmlwZSk7XG5cbiAgICAgICAgdGhpcy5zdHJpcGUkLm5leHQoc3RyaXBlKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZ2V0SW5zdGFuY2UoKTogU3RyaXBlIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUkLmdldFZhbHVlKCk7XG4gIH1cblxuICBlbGVtZW50cyhvcHRpb25zPzogU3RyaXBlRWxlbWVudHNPcHRpb25zKTogT2JzZXJ2YWJsZTxTdHJpcGVFbGVtZW50cz4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZSQuYXNPYnNlcnZhYmxlKCkucGlwZShcbiAgICAgIGZpbHRlcigoc3RyaXBlKSA9PiBCb29sZWFuKHN0cmlwZSkpLFxuICAgICAgbWFwKChzdHJpcGUpID0+IHN0cmlwZS5lbGVtZW50cyhvcHRpb25zKSksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIHJlZGlyZWN0VG9DaGVja291dChcbiAgICBvcHRpb25zPzogUmVkaXJlY3RUb0NoZWNrb3V0T3B0aW9uc1xuICApOiBPYnNlcnZhYmxlPG5ldmVyIHwgeyBlcnJvcjogU3RyaXBlRXJyb3IgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+IGZyb20oc3RyaXBlLnJlZGlyZWN0VG9DaGVja291dChvcHRpb25zKSkpLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtQXVCZWNzRGViaXRQYXltZW50KFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nLFxuICAgIGRhdGE/OiBDb25maXJtQXVCZWNzRGViaXRQYXltZW50RGF0YVxuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY29uZmlybUF1QmVjc0RlYml0UGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUJhbmNvbnRhY3RQYXltZW50KFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nLFxuICAgIGRhdGE/OiBDb25maXJtQmFuY29udGFjdFBheW1lbnREYXRhLFxuICAgIG9wdGlvbnM/OiBDb25maXJtQmFuY29udGFjdFBheW1lbnRPcHRpb25zXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtQmFuY29udGFjdFBheW1lbnQoY2xpZW50U2VjcmV0LCBkYXRhLCBvcHRpb25zKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpcm1DYXJkUGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybUNhcmRQYXltZW50RGF0YSxcbiAgICBvcHRpb25zPzogQ29uZmlybUNhcmRQYXltZW50T3B0aW9uc1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbShzdHJpcGUuY29uZmlybUNhcmRQYXltZW50KGNsaWVudFNlY3JldCwgZGF0YSwgb3B0aW9ucykpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtRXBzUGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybUVwc1BheW1lbnREYXRhLFxuICAgIG9wdGlvbnM/OiBDb25maXJtRXBzUGF5bWVudE9wdGlvbnNcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oc3RyaXBlLmNvbmZpcm1FcHNQYXltZW50KGNsaWVudFNlY3JldCwgZGF0YSwgb3B0aW9ucykpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtRnB4UGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybUZweFBheW1lbnREYXRhLFxuICAgIG9wdGlvbnM/OiBDb25maXJtRnB4UGF5bWVudE9wdGlvbnNcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oc3RyaXBlLmNvbmZpcm1GcHhQYXltZW50KGNsaWVudFNlY3JldCwgZGF0YSwgb3B0aW9ucykpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtR2lyb3BheVBheW1lbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1HaXJvcGF5UGF5bWVudERhdGEsXG4gICAgb3B0aW9ucz86IENvbmZpcm1HaXJvcGF5UGF5bWVudE9wdGlvbnNcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oc3RyaXBlLmNvbmZpcm1HaXJvcGF5UGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEsIG9wdGlvbnMpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUlkZWFsUGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybUlkZWFsUGF5bWVudERhdGEsXG4gICAgb3B0aW9ucz86IENvbmZpcm1JZGVhbFBheW1lbnRPcHRpb25zXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtSWRlYWxQYXltZW50KGNsaWVudFNlY3JldCwgZGF0YSwgb3B0aW9ucykpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtUDI0UGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybVAyNFBheW1lbnREYXRhLFxuICAgIG9wdGlvbnM/OiBDb25maXJtUDI0UGF5bWVudE9wdGlvbnNcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oc3RyaXBlLmNvbmZpcm1QMjRQYXltZW50KGNsaWVudFNlY3JldCwgZGF0YSwgb3B0aW9ucykpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICBjb25maXJtU2VwYURlYml0UGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybVNlcGFEZWJpdFBheW1lbnREYXRhXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRJbnRlbnQ/OiBQYXltZW50SW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtU2VwYURlYml0UGF5bWVudChjbGllbnRTZWNyZXQsIGRhdGEpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgaGFuZGxlQ2FyZEFjdGlvbihcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZ1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT4gZnJvbShzdHJpcGUuaGFuZGxlQ2FyZEFjdGlvbihjbGllbnRTZWNyZXQpKSksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNyZWF0ZVBheW1lbnRNZXRob2QoXG4gICAgcGF5bWVudE1ldGhvZERhdGE6IENyZWF0ZVBheW1lbnRNZXRob2REYXRhXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHBheW1lbnRNZXRob2Q/OiBQYXltZW50TWV0aG9kO1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jcmVhdGVQYXltZW50TWV0aG9kKHBheW1lbnRNZXRob2REYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIHJldHJpZXZlUGF5bWVudEludGVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZ1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT4gZnJvbShzdHJpcGUucmV0cmlldmVQYXltZW50SW50ZW50KGNsaWVudFNlY3JldCkpKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUF1QmVjc0RlYml0U2V0dXAoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZGF0YT86IENvbmZpcm1BdUJlY3NEZWJpdFNldHVwRGF0YVxuICApOiBPYnNlcnZhYmxlPHtcbiAgICBzZXR1cEludGVudD86IFNldHVwSW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtQXVCZWNzRGViaXRTZXR1cChjbGllbnRTZWNyZXQsIGRhdGEpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY29uZmlybUNhcmRTZXR1cChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybUNhcmRTZXR1cERhdGEsXG4gICAgb3B0aW9ucz86IENvbmZpcm1DYXJkU2V0dXBPcHRpb25zXG4gICk6IE9ic2VydmFibGU8e1xuICAgIHNldHVwSW50ZW50PzogU2V0dXBJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oc3RyaXBlLmNvbmZpcm1DYXJkU2V0dXAoY2xpZW50U2VjcmV0LCBkYXRhLCBvcHRpb25zKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIGNvbmZpcm1TZXBhRGViaXRTZXR1cChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBkYXRhPzogQ29uZmlybVNlcGFEZWJpdFNldHVwRGF0YVxuICApOiBPYnNlcnZhYmxlPHtcbiAgICBzZXR1cEludGVudD86IFNldHVwSW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKHN0cmlwZS5jb25maXJtU2VwYURlYml0U2V0dXAoY2xpZW50U2VjcmV0LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIHJldHJpZXZlU2V0dXBJbnRlbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmdcbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgc2V0dXBJbnRlbnQ/OiBTZXR1cEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT4gZnJvbShzdHJpcGUuY29uZmlybVNlcGFEZWJpdFNldHVwKGNsaWVudFNlY3JldCkpKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgcGF5bWVudFJlcXVlc3Qob3B0aW9uczogUGF5bWVudFJlcXVlc3RPcHRpb25zKTogUGF5bWVudFJlcXVlc3QgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IHN0cmlwZSA9IHRoaXMuZ2V0SW5zdGFuY2UoKTtcblxuICAgIHJldHVybiBzdHJpcGUgPyBzdHJpcGUucGF5bWVudFJlcXVlc3Qob3B0aW9ucykgOiB1bmRlZmluZWQ7XG4gIH1cblxuICBjcmVhdGVUb2tlbihcbiAgICB0b2tlblR5cGU6IFN0cmlwZUliYW5FbGVtZW50LFxuICAgIGRhdGE6IENyZWF0ZVRva2VuSWJhbkRhdGFcbiAgKTogT2JzZXJ2YWJsZTx7IHRva2VuPzogVG9rZW47IGVycm9yPzogU3RyaXBlRXJyb3IgfT47XG4gIGNyZWF0ZVRva2VuKFxuICAgIHRva2VuVHlwZTogU3RyaXBlQ2FyZEVsZW1lbnQgfCBTdHJpcGVDYXJkTnVtYmVyRWxlbWVudCxcbiAgICBkYXRhPzogQ3JlYXRlVG9rZW5DYXJkRGF0YVxuICApOiBPYnNlcnZhYmxlPHsgdG9rZW4/OiBUb2tlbjsgZXJyb3I/OiBTdHJpcGVFcnJvciB9PjtcbiAgY3JlYXRlVG9rZW4oXG4gICAgdG9rZW5UeXBlOiAncGlpJyxcbiAgICBkYXRhOiBDcmVhdGVUb2tlblBpaURhdGFcbiAgKTogT2JzZXJ2YWJsZTx7IHRva2VuPzogVG9rZW47IGVycm9yPzogU3RyaXBlRXJyb3IgfT47XG4gIGNyZWF0ZVRva2VuKFxuICAgIHRva2VuVHlwZTogJ2JhbmtfYWNjb3VudCcsXG4gICAgZGF0YTogQ3JlYXRlVG9rZW5CYW5rQWNjb3VudERhdGFcbiAgKTogT2JzZXJ2YWJsZTx7IHRva2VuPzogVG9rZW47IGVycm9yPzogU3RyaXBlRXJyb3IgfT47XG4gIGNyZWF0ZVRva2VuKFxuICAgIHRva2VuVHlwZTogJ2N2Y191cGRhdGUnLFxuICAgIGVsZW1lbnQ/OiBTdHJpcGVDYXJkQ3ZjRWxlbWVudFxuICApOiBPYnNlcnZhYmxlPHsgdG9rZW4/OiBUb2tlbjsgZXJyb3I/OiBTdHJpcGVFcnJvciB9PjtcbiAgY3JlYXRlVG9rZW4oXG4gICAgdG9rZW5UeXBlOiAnYWNjb3VudCcsXG4gICAgZGF0YTogVG9rZW5DcmVhdGVQYXJhbXMuQWNjb3VudFxuICApOiBPYnNlcnZhYmxlPHsgdG9rZW4/OiBUb2tlbjsgZXJyb3I/OiBTdHJpcGVFcnJvciB9PjtcbiAgY3JlYXRlVG9rZW4oXG4gICAgdG9rZW5UeXBlOiAncGVyc29uJyxcbiAgICBkYXRhOiBUb2tlbkNyZWF0ZVBhcmFtcy5QZXJzb25cbiAgKTogT2JzZXJ2YWJsZTx7IHRva2VuPzogVG9rZW47IGVycm9yPzogU3RyaXBlRXJyb3IgfT47XG4gIGNyZWF0ZVRva2VuKHRva2VuVHlwZSwgZGF0YSkge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+IGZyb20oc3RyaXBlLmNyZWF0ZVRva2VuKHRva2VuVHlwZSwgZGF0YSkpKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgY3JlYXRlU291cmNlKFxuICAgIGVsZW1lbnQ6IFN0cmlwZUVsZW1lbnQsXG4gICAgc291cmNlRGF0YTogQ3JlYXRlU291cmNlRGF0YVxuICApOiBPYnNlcnZhYmxlPHsgc291cmNlPzogU291cmNlOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+O1xuICBjcmVhdGVTb3VyY2UoXG4gICAgc291cmNlRGF0YTogQ3JlYXRlU291cmNlRGF0YVxuICApOiBPYnNlcnZhYmxlPHsgc291cmNlPzogU291cmNlOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+O1xuICBjcmVhdGVTb3VyY2UoYSwgYj8pOiBPYnNlcnZhYmxlPHsgc291cmNlPzogU291cmNlOyBlcnJvcj86IFN0cmlwZUVycm9yIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PiBmcm9tKHN0cmlwZS5jcmVhdGVTb3VyY2UoYSwgYikpKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgcmV0cmlldmVTb3VyY2UoXG4gICAgc291cmNlOiBSZXRyaWV2ZVNvdXJjZVBhcmFtXG4gICk6IE9ic2VydmFibGU8eyBzb3VyY2U/OiBTb3VyY2U7IGVycm9yPzogU3RyaXBlRXJyb3IgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+IGZyb20oc3RyaXBlLnJldHJpZXZlU291cmNlKHNvdXJjZSkpKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqL1xuICBoYW5kbGVDYXJkUGF5bWVudChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBlbGVtZW50PyxcbiAgICBkYXRhP1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBwYXltZW50SW50ZW50PzogUGF5bWVudEludGVudDtcbiAgICBlcnJvcj86IFN0cmlwZUVycm9yO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMuc3RyaXBlLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHN0cmlwZSkgPT5cbiAgICAgICAgZnJvbSgoc3RyaXBlIGFzIGFueSkuaGFuZGxlQ2FyZFBheW1lbnQoY2xpZW50U2VjcmV0LCBlbGVtZW50LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKi9cbiAgY29uZmlybVBheW1lbnRJbnRlbnQoXG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmcsXG4gICAgZWxlbWVudD8sXG4gICAgZGF0YT9cbiAgKTogT2JzZXJ2YWJsZTx7XG4gICAgcGF5bWVudEludGVudD86IFBheW1lbnRJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oKHN0cmlwZSBhcyBhbnkpLmNvbmZpcm1QYXltZW50SW50ZW50KGNsaWVudFNlY3JldCwgZWxlbWVudCwgZGF0YSkpXG4gICAgICApLFxuICAgICAgZmlyc3QoKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICovXG4gIGhhbmRsZUNhcmRTZXR1cChcbiAgICBjbGllbnRTZWNyZXQ6IHN0cmluZyxcbiAgICBlbGVtZW50PyxcbiAgICBkYXRhP1xuICApOiBPYnNlcnZhYmxlPHtcbiAgICBzZXR1cEludGVudD86IFNldHVwSW50ZW50O1xuICAgIGVycm9yPzogU3RyaXBlRXJyb3I7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5zdHJpcGUucGlwZShcbiAgICAgIHN3aXRjaE1hcCgoc3RyaXBlKSA9PlxuICAgICAgICBmcm9tKChzdHJpcGUgYXMgYW55KS5oYW5kbGVDYXJkU2V0dXAoY2xpZW50U2VjcmV0LCBlbGVtZW50LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKi9cbiAgY29uZmlybVNldHVwSW50ZW50KFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nLFxuICAgIGVsZW1lbnQ/LFxuICAgIGRhdGE/XG4gICk6IE9ic2VydmFibGU8e1xuICAgIHNldHVwSW50ZW50PzogU2V0dXBJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oKHN0cmlwZSBhcyBhbnkpLmNvbmZpcm1TZXR1cEludGVudChjbGllbnRTZWNyZXQsIGVsZW1lbnQsIGRhdGEpKVxuICAgICAgKSxcbiAgICAgIGZpcnN0KClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqL1xuICBoYW5kbGVGcHhQYXltZW50KFxuICAgIGNsaWVudFNlY3JldDogc3RyaW5nLFxuICAgIGVsZW1lbnQ/LFxuICAgIGRhdGE/XG4gICk6IE9ic2VydmFibGU8e1xuICAgIHNldHVwSW50ZW50PzogU2V0dXBJbnRlbnQ7XG4gICAgZXJyb3I/OiBTdHJpcGVFcnJvcjtcbiAgfT4ge1xuICAgIHJldHVybiB0aGlzLnN0cmlwZS5waXBlKFxuICAgICAgc3dpdGNoTWFwKChzdHJpcGUpID0+XG4gICAgICAgIGZyb20oKHN0cmlwZSBhcyBhbnkpLmhhbmRsZUZweFBheW1lbnQoY2xpZW50U2VjcmV0LCBlbGVtZW50LCBkYXRhKSlcbiAgICAgICksXG4gICAgICBmaXJzdCgpXG4gICAgKTtcbiAgfVxufVxuIl19